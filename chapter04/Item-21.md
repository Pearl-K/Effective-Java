# Item 21. 인터페이스는 구현하는 쪽을 생각해 설계하라
- Java8+ 이전에는 인터페이스에 메서드를 추가할 방법이 없었다.
- Java8+ 이후, 디폴트 메서드가 추가되면서 기존 구현체를 깨뜨리지 않고 인터페이스에 메서드를 추가할 수 있게 되었다.
- 그러나 이를 사용할 때 조심해서 사용해야 한다.


## 디폴트 메서드를 사용할 때 주의할 점

### 🔸 기존 구현체가 안전하게 동작할지 반드시 고려할 것

* **디폴트 메서드는 기존 구현체에도 자동으로 적용된다.**
* 그러나 모든 기존 구현체가 **디폴트 구현과 호환된다는 보장은 없다.**
* 예: `removeIf()`는 내부 동기화가 필요한 클래스에서 문제를 일으킬 수 있음.

> 예외나 데이터 불일치, `ConcurrentModificationException` 발생 가능

---

### 🔸 디폴트 메서드는 구현 세부사항(lock, 상태 등)을 알 수 없다

* **동기화**, **상태 공유**, **리소스 관리**가 필요한 클래스는 디폴트 메서드의 일반적인 구현을 안전하게 사용할 수 없다.
* 디폴트 메서드는 인터페이스 수준의 일반 논리만 작성 가능하며, **세부 동작은 구현체마다 다를 수 있음.**

> 디폴트 메서드는 최종 구현 클래스의 문맥(context)을 모른다.

---

### 🔸 컴파일은 되더라도 런타임 오류가 발생할 수 있다

* 컴파일러는 디폴트 메서드가 안전한지까지는 판단하지 못함.
* 따라서, 구현체의 내부 상태/제약을 고려하지 않고 메서드가 실행될 수 있다.

> 특히, Java 8 이전에 작성된 구현체에서는 더 큰 리스크

---

### 🔸 꼭 필요한 경우가 아니라면 기존 인터페이스에 디폴트 메서드 추가는 피하라

* 라이브러리처럼 **이미 배포된 API에 디폴트 메서드 추가는 위험하다.**
* 신중하게, 많은 테스트를 거쳐서 결정해야 하며, **하위 호환성을 철저히 고려해야 한다.**

> 리팩터링 편의를 위해 디폴트 메서드를 남용하면 오히려 API 품질이 나빠질 수 있다.

---

### 🔸 새 인터페이스에는 디폴트 메서드가 유용하다

* 새롭게 정의되는 인터페이스에 한해, **구현체가 따르기 쉬운 기본 동작을 제공할 수 있다.**
* 적절히 활용하면 **인터페이스 구현의 부담을 줄이고 일관성 있는 기본 동작을 제공**할 수 있다.

> `Collection.removeIf()` 같은 경우, 새 인터페이스였다면 유용한 예가 됨.

---

### 🔸 디폴트 메서드는 "추가" 용도로만 사용하라

* 기존 메서드를 제거하거나 시그니처를 바꾸는 **"수정" 용도로 사용하면 안 된다.**
* 디폴트 메서드는 호환성을 지키며 **기능을 확장할 때만** 사용해야 한다.

> 기존 메서드를 디폴트 메서드로 대체하는 건 API 안정성에 위협

---

## Summary
- 디폴트 메서드는 신중히 사용해야 하며, 기존 구현체의 동작을 깨뜨리지 않도록 철저히 고려해야 한다.


