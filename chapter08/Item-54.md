# Item 54. null이 아닌, 빈 컬렉션이나 배열을 반환하라

결과 컬렉션이 비어있거나 없을 때, null 을 반환하는 코드가 있을 수 있다. 그러나 이런 상황에도 null을 반환하는 코드를 짜면 안된다.


왜냐하면 클라이언트에 null 을 추가로 처리해야하는 책임이 생기고, 일일히 방어 코드를 작성해야 한다. (이걸 null 처리 책임이라고도 함)


따라서, 빈 컬렉션이나 배열을 반환해주는 것이 좋다. (이를 따로 Null Object Pattern 이라고도 부름) 


Null Object Pattern을 사용하면, `null` 처리 로직이 전파되는 문제를 줄일 수 있고, `null`을 체크하는 중복 코드를 줄일 수 있어서 코드가 단순하고 깔끔해진다.


---
## 빈 컨테이너를 주는 것이 Null을 주는 것에 비해 비용 소모인가?
위 질문에 대해 책은 틀린 주장이라고 말하며, 아래와 같은 두 가지 근거를 제시한다.


1. 자세한 성능 분석 결과, 이 할당이 성능 저하의 주범임이 밝혀지지 않는 한, 아주 미미한 성능 차이일 것이다.
2. 빈 컬렉션과 배열은 굳이 새로 할당하지 않고도 반환할 수 있다.


또한, 빈 컬렉션을 할당하는 것이 성능을 저하시킨다면, 매번 똑같은 비어있는 "불변" 컬렉션을 반환하게 만들면 된다. 불변 객체는 자유롭게 공유해도 안전하기 때문이다.
- `Collections.emptyList` & `Collections.emptyMap` 등이 대표적인 예시이다.


---
## 배열에서도 마찬가지로, 길이가 0인 배열 반환하기
보통, 정확한 길이의 배열을 반환해주면 되기 때문에, 결과 값이 없다면 길이가 0인 배열을 반환하면 된다.


매번 빈 배열을 할당하는 것이 싫다면, 아래와 같이 미리 선언해둔 배열을 반환하면 된다.


```java
private static final Cheese[] EMPTY_CHEESE_ARRAY = new Cheese[0];

public Cheese[] getCheeses() {
    return cheesesInStock.toArray(EMPTY_CHEESE_ARRAY);
}
```


그러나 단순 성능 개선 목적이라면, `toArray` 에 넘기는 배열을 미리 할당하는 것을 추천하지 않는다. 오히려 성능이 저하된다는 연구 결과도 있기 때문이다.


---
## Summary
- null 이 아닌, 빈 배열이나 컬렉션을 반환하라 null을 반환하는 API는 사용하기 어렵고, 오류 처리 코드가 늘어나며, 성능이 좋은 것도 아니다.
