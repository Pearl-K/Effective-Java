# Item 82. 스레드 안전성 수준을 문서화하라
클래스, 메서드를 만들 때 지원하는 스레드 안전성 수준을 정확히 명시해야 한다.

다음 목록처럼, 스레드 안전성에 대해 문서화할 때 명시하는 것이 중요하다.


## (스레드 안전성이 높은 순으로) 표기 방법
- 불변 (immutable)
- 무조건적 스레드 안전(unconditionally thread-safe)
- 조건부 스레드 안전(conditionally thread-safe)
- 스레드 안전하지 않음(not thread-safe)
- 스레드 적대적(thread-hostile)


### 조건부 스레드 안전 (주의사항!)
- 이에 해당하는 클래스나 메서드는 주의해서 문서화해야한다.
- 어떤 순서로 호출해야 하는지, 어떤 순서에서 외부 동기화가 필요한지, 순서대로 호출을 안전하게 할 때 필요한 Lock, 획득해야하는 Lock 조건들을 잘 알려줘야 한다.



## 클래스 & 메서드 별 기재 방식
- 클래스의 스레드 안정성은 보통 클래스의 문서화 주석에 기재
- 독특한 메서드라면, 해당 메서드의 주석에 기재


## 비공개 락 객체 관용구
비공개 락 객체는 클래스 바깥에서 볼 수 없어서, 클라이언트가 그 객체의 동기화에 관여할 수 없다. (락 객체를 동기화 대상 객체 안으로 캡슐화)


```java
// 어떤 클래스 내부
private final Object lock = new Object();
public void foo() {
    synchronized(lock) {
        // ...
    }
}
```


- 위 코드처럼 lock 필드를 `final` 으로 선언하면 락 객체가 교체되는 일을 예방해준다.
- 락 필드의 변경 가능성을 최소화 한 것이다.
- 예시 코드와 같이 락 필드를 항상 `final` 으로 선언하라.
    - 일반적인 모니터 락이든, `concurrent.locks` 패키지 내부의 락이든 마찬가지로


---
## Summary
- 모든 클래스가 자신의 스레드 안전성 정보를 명확하게 문서화해야 한다. 
- 정확한 언어로 명시하거나, 스레드 안전성을 뜻하는 어노테이션을 붙일 수 있다.
- 조건부 스레드 안전 클래스는 스레드 안전 조건을 잘 문서화해야 한다.
    - 어떤 순서로 호출할 때 외부 동기화가 요구되는지, 어떤 락을 얻어야 하는 지 등등
- 무조건적 스레드 안전 클래스를 작성할 때는 비공개 락 객체를 사용하자.
    - 우연히 락 객체가 교체되거나
    - 하위 클래스에서 동기화 매커니즘을 깨트리는 걸 예방할 수 있다.
